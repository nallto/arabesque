<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é¡”ç‰¹å¾´ç‚¹æ¤œå‡º - é«˜åº¦ç‰ˆ</title>
    <!-- ãƒãƒ†ãƒªã‚¢ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ•ã‚©ãƒ³ãƒˆ -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/material-design-icons/3.0.1/iconfont/material-icons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/Roboto/0.2.0/roboto-fontface.css" rel="stylesheet">
    <!-- TensorFlow.js ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
    <!-- BlazeFace ãƒ¢ãƒ‡ãƒ« -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.0.7/dist/blazeface.min.js"></script>
    <style>
        :root {
            --primary-color: #3f51b5;
            --primary-light: #757de8;
            --primary-dark: #002984;
            --accent-color: #ff4081;
            --text-on-primary: #ffffff;
            --text-primary: rgba(0, 0, 0, 0.87);
            --text-secondary: rgba(0, 0, 0, 0.54);
            --background-color: #f5f5f5;
            --card-color: #ffffff;
            --divider-color: rgba(0, 0, 0, 0.12);
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', 'Noto Sans JP', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.5;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .app-bar {
            background-color: var(--primary-color);
            color: var(--text-on-primary);
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .app-title {
            font-size: 1.25rem;
            font-weight: 500;
            margin-left: 8px;
        }
        
        .main-content {
            flex: 1;
            padding: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .card {
            background-color: var(--card-color);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
            overflow: hidden;
            margin-bottom: 24px;
            width: 100%;
        }
        
        .card-title {
            padding: 16px;
            font-size: 1.25rem;
            font-weight: 500;
            border-bottom: 1px solid var(--divider-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-content {
            padding: 16px;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            margin: 0 auto;
            border-radius: 4px;
            overflow: hidden;
        }
        
        video, canvas {
            width: 100%;
            max-width: 640px;
            max-height: 480px;
            display: block;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 16px;
            justify-content: center;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0 16px;
            height: 36px;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.0892857143em;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
        }
        
        .btn-icon {
            margin-right: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: var(--text-on-primary);
        }
        
        .btn-primary:hover {
            background-color: var(--primary-light);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary:disabled {
            background-color: rgba(0, 0, 0, 0.12);
            color: rgba(0, 0, 0, 0.38);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .btn-accent {
            background-color: var(--accent-color);
            color: var(--text-on-primary);
        }
        
        .btn-accent:hover {
            background-color: #ff5a92;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .btn-accent:disabled {
            background-color: rgba(0, 0, 0, 0.12);
            color: rgba(0, 0, 0, 0.38);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .info-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-top: 16px;
        }
        
        .info-card {
            flex: 1;
            min-width: 200px;
            background-color: var(--card-color);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 16px;
        }
        
        .info-card-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .status-bar {
            display: flex;
            align-items: center;
            margin-top: 16px;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .status-message {
            flex: 1;
        }
        
        .fps-counter {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .part-detection-list {
            list-style: none;
            margin-top: 8px;
        }
        
        .part-detection-item {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }
        
        .part-icon {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .part-status {
            flex: 1;
        }
        
        .detected {
            color: var(--success-color);
        }
        
        .not-detected {
            color: var(--error-color);
        }
        
        .options-container {
            margin-top: 16px;
        }
        
        .option-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .option-label {
            flex: 1;
            font-size: 0.875rem;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 36px;
            height: 20px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.38);
            transition: .4s;
            border-radius: 10px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(16px);
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }
            
            .info-card {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-bar">
            <i class="material-icons">face</i>
            <h1 class="app-title">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é¡”ç‰¹å¾´ç‚¹æ¤œå‡º - é«˜åº¦ç‰ˆ</h1>
        </header>
        
        <main class="main-content">
            <div class="card">
                <div class="card-title">
                    <span>ã‚«ãƒ¡ãƒ©ãƒ“ãƒ¥ãƒ¼</span>
                    <div id="fps" class="fps-counter">0 FPS</div>
                </div>
                <div class="card-content">
                    <div class="video-container">
                        <video id="video" autoplay muted playsinline></video>
                        <canvas id="canvas"></canvas>
                        <div id="fps-display" class="fps-counter">0 FPS</div>
                    </div>
                    
                    <div class="controls">
                        <button id="startButton" class="btn btn-primary" disabled>
                            <i class="material-icons btn-icon">videocam</i>
                            ã‚«ãƒ¡ãƒ©é–‹å§‹
                        </button>
                        <button id="stopButton" class="btn btn-accent" disabled>
                            <i class="material-icons btn-icon">stop</i>
                            åœæ­¢
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="info-panel">
                <div class="info-card">
                    <h3 class="info-card-title">é¡”ãƒ‘ãƒ¼ãƒ„æ¤œå‡ºçŠ¶æ³</h3>
                    <ul class="part-detection-list" id="parts-list">
                        <li class="part-detection-item">
                            <div class="part-icon"><i class="material-icons">face</i></div>
                            <div class="part-status">é¡”: <span id="face-status" class="not-detected">æœªæ¤œå‡º</span></div>
                        </li>
                        <li class="part-detection-item">
                            <div class="part-icon"><i class="material-icons">remove_red_eye</i></div>
                            <div class="part-status">ç›®: <span id="eyes-status" class="not-detected">æœªæ¤œå‡º</span></div>
                        </li>
                        <li class="part-detection-item">
                            <div class="part-icon">ğŸ‘ƒ</div>
                            <div class="part-status">é¼»: <span id="nose-status" class="not-detected">æœªæ¤œå‡º</span></div>
                        </li>
                        <li class="part-detection-item">
                            <div class="part-icon">ğŸ‘„</div>
                            <div class="part-status">å£: <span id="mouth-status" class="not-detected">æœªæ¤œå‡º</span></div>
                        </li>
                        <li class="part-detection-item">
                            <div class="part-icon">ğŸ‘‚</div>
                            <div class="part-status">è€³: <span id="ears-status" class="not-detected">æœªæ¤œå‡º</span></div>
                        </li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3 class="info-card-title">æ¤œå‡ºæƒ…å ±</h3>
                    <div id="detection-info">
                        <p>ç‰¹å¾´ç‚¹: <span id="landmark-count">0</span> ç‚¹</p>
                        <p>æ¤œå‡ºç²¾åº¦: <span id="detection-score">0</span>%</p>
                        <p>å‡¦ç†æ™‚é–“: <span id="processing-time">0</span> ms</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³</div>
                <div class="card-content">
                    <div class="options-container">
                        <div class="option-row">
                            <span class="option-label">é¡”ã®å¢ƒç•Œãƒœãƒƒã‚¯ã‚¹ã‚’è¡¨ç¤º</span>
                            <label class="switch">
                                <input type="checkbox" id="show-box" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="option-row">
                            <span class="option-label">ç‰¹å¾´ç‚¹ã‚’è¡¨ç¤º</span>
                            <label class="switch">
                                <input type="checkbox" id="show-landmarks" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="option-row">
                            <span class="option-label">è¼ªéƒ­ç·šã‚’è¡¨ç¤º</span>
                            <label class="switch">
                                <input type="checkbox" id="show-wireframe" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="status-bar">
                <div id="status" class="status-message">ãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>
        </main>
    </div>
    
    <script>
        // DOMè¦ç´ 
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const statusElement = document.getElementById('status');
        const fpsDisplay = document.getElementById('fps-display');
        const landmarkCountElement = document.getElementById('landmark-count');
        const detectionScoreElement = document.getElementById('detection-score');
        const processingTimeElement = document.getElementById('processing-time');
        
        // ãƒ‘ãƒ¼ãƒ„æ¤œå‡ºã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¦ç´ 
        const faceStatusElement = document.getElementById('face-status');
        const eyesStatusElement = document.getElementById('eyes-status');
        const noseStatusElement = document.getElementById('nose-status');
        const mouthStatusElement = document.getElementById('mouth-status');
        const earsStatusElement = document.getElementById('ears-status');
        
        // è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³
        const showBoxCheckbox = document.getElementById('show-box');
        const showLandmarksCheckbox = document.getElementById('show-landmarks');
        const showWireframeCheckbox = document.getElementById('show-wireframe');
        
        // å¤‰æ•°
        let isRunning = false;
        let stream = null;
        let model = null;
        let animationId = null;
        let lastFrameTime = 0;
        let frameCount = 0;
        let lastFpsUpdateTime = 0;
        let currentFps = 0;
        
        // FPSè¨ˆç®—ç”¨ã®å¤‰æ•°
        function updateFps() {
            const now = performance.now();
            frameCount++;
            
            // 500ãƒŸãƒªç§’ã”ã¨ã«FPSã‚’æ›´æ–°
            if (now - lastFpsUpdateTime >= 500) {
                currentFps = Math.round((frameCount * 1000) / (now - lastFpsUpdateTime));
                fpsDisplay.textContent = `${currentFps} FPS`;
                lastFpsUpdateTime = now;
                frameCount = 0;
            }
        }
        
        // ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿
        async function loadModel() {
            try {
                statusElement.textContent = 'BlazeFaceãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...';
                
                // BlazeFaceãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚€
                model = await blazeface.load();
                
                statusElement.textContent = 'ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã‚«ãƒ¡ãƒ©ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚';
                startButton.disabled = false;
            } catch (error) {
                statusElement.textContent = `ã‚¨ãƒ©ãƒ¼: ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ - ${error.message}`;
                console.error('ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error);
            }
        }
        
        // ã‚«ãƒ¡ãƒ©ã®é–‹å§‹
        async function startCamera() {
            if (isRunning) return;
            
            try {
                // ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
                stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }
                });
                
                video.srcObject = stream;
                
                // ãƒ“ãƒ‡ã‚ªã®æº–å‚™ãŒã§ãã‚‹ã®ã‚’å¾…ã¤
                await new Promise(resolve => {
                    video.onloadedmetadata = () => {
                        resolve();
                    };
                });
                
                // ãƒ“ãƒ‡ã‚ªå†ç”Ÿé–‹å§‹
                await video.play();
                
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚µã‚¤ã‚ºã‚’ãƒ“ãƒ‡ã‚ªã«åˆã‚ã›ã‚‹
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // æ¤œå‡ºé–‹å§‹
                isRunning = true;
                lastFrameTime = performance.now();
                lastFpsUpdateTime = performance.now();
                frameCount = 0;
                detectFaces();
                
                // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
                startButton.disabled = true;
                stopButton.disabled = false;
                statusElement.textContent = 'é¡”ç‰¹å¾´ç‚¹æ¤œå‡ºå®Ÿè¡Œä¸­...';
            } catch (error) {
                statusElement.textContent = `ã‚¨ãƒ©ãƒ¼: ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«å¤±æ•—ã—ã¾ã—ãŸ - ${error.message}`;
                console.error('ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«å¤±æ•—:', error);
            }
        }
        
        // ã‚«ãƒ¡ãƒ©ã®åœæ­¢
        function stopCamera() {
            if (!isRunning) return;
            
            // ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®åœæ­¢
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
                stream = null;
            }
            
            // æ¤œå‡ºå‡¦ç†ã®åœæ­¢
            isRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚¯ãƒªã‚¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒªã‚»ãƒƒãƒˆ
            resetDetectionStatus();
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            startButton.disabled = false;
            stopButton.disabled = true;
            statusElement.textContent = 'åœæ­¢ã—ã¾ã—ãŸ';
        }
        
        // æ¤œå‡ºã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒªã‚»ãƒƒãƒˆ
        function resetDetectionStatus() {
            faceStatusElement.textContent = 'æœªæ¤œå‡º';
            faceStatusElement.className = 'not-detected';
            eyesStatusElement.textContent = 'æœªæ¤œå‡º';
            eyesStatusElement.className = 'not-detected';
            noseStatusElement.textContent = 'æœªæ¤œå‡º';
            noseStatusElement.className = 'not-detected';
            mouthStatusElement.textContent = 'æœªæ¤œå‡º';
            mouthStatusElement.className = 'not-detected';
            earsStatusElement.textContent = 'æœªæ¤œå‡º';
            earsStatusElement.className = 'not-detected';
            
            landmarkCountElement.textContent = '0';
            detectionScoreElement.textContent = '0';
            processingTimeElement.textContent = '0';
            fpsDisplay.textContent = '0 FPS';
        }
        
        // é¡”ã®æ¤œå‡ºã¨ç‰¹å¾´ç‚¹ã®æç”»
        async function detectFaces() {
            if (!isRunning) return;
            
            const startTime = performance.now();
            
            try {
                // FPSè¡¨ç¤ºã®æ›´æ–°
                updateFps();
                
                // BlazeFaceãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¦é¡”æ¤œå‡ºã‚’å®Ÿè¡Œ
                const predictions = await model.estimateFaces(video);
                
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚¯ãƒªã‚¢
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // æ¤œå‡ºã•ã‚ŒãŸé¡”ãŒã‚ã‚‹å ´åˆã¯æç”»
                if (predictions && predictions.length > 0) {
                    const face = predictions[0]; // ç¾åœ¨ã¯1ã¤ã®é¡”ã®ã¿ã‚’ã‚µãƒãƒ¼ãƒˆ
                    
                    // é¡”æ¤œå‡ºã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                    updateFaceDetectionStatus(face);
                    
                    // æƒ…å ±ã®æ›´æ–°ï¼ˆBlazeFaceã§ã¯ç‰¹å¾´ç‚¹ã¯é™å®šçš„ï¼‰
                    const landmarkCount = face.landmarks ? face.landmarks.length : 0;
                    landmarkCountElement.textContent = landmarkCount.toString();
                    
                    // æ¤œå‡ºç²¾åº¦
                    const score = Math.round(face.probability[0] * 100);
                    detectionScoreElement.textContent = score.toString();
                    
                    // å¢ƒç•Œãƒœãƒƒã‚¯ã‚¹ã®æç”»ï¼ˆæœ‰åŠ¹ãªå ´åˆï¼‰
                    if (showBoxCheckbox.checked) {
                        drawBoundingBox({
                            topLeft: face.topLeft,
                            bottomRight: face.bottomRight
                        });
                    }
                    
                    // ç‰¹å¾´ç‚¹ã®æç”»ï¼ˆæœ‰åŠ¹ãªå ´åˆï¼‰
                    if (showLandmarksCheckbox.checked && face.landmarks) {
                        drawFacialLandmarks(face.landmarks);
                    }
                    
                    // ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã®æç”»ï¼ˆBlazeFaceã¯ã‚·ãƒ³ãƒ—ãƒ«ãªç‰¹å¾´ç‚¹ã®ãŸã‚ã€ç°¡æ˜“çš„ãªè¼ªéƒ­ã‚’æç”»ï¼‰
                    if (showWireframeCheckbox.checked && face.landmarks) {
                        drawSimpleFacialWireframe(face);
                    }
                } else {
                    // é¡”ãŒæ¤œå‡ºã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
                    resetDetectionStatus();
                }
                
                // å‡¦ç†æ™‚é–“ã®æ›´æ–°
                const processingTime = Math.round(performance.now() - startTime);
                processingTimeElement.textContent = processingTime.toString();
                
            } catch (error) {
                console.error('é¡”æ¤œå‡ºã‚¨ãƒ©ãƒ¼:', error);
                statusElement.textContent = `æ¤œå‡ºã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
            
            // æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’å‡¦ç†
            animationId = requestAnimationFrame(detectFaces);
        }
        
        // é¡”æ¤œå‡ºã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ï¼ˆBlazeFaceç”¨ã«ç°¡ç•¥åŒ–ï¼‰
        function updateFaceDetectionStatus(face) {
            // é¡”ã®æ¤œå‡ºçŠ¶æ…‹ã‚’æ›´æ–°
            faceStatusElement.textContent = 'æ¤œå‡º';
            faceStatusElement.className = 'detected';
            
            // BlazeFaceã®ç‰¹å¾´ç‚¹ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
            // 0: å³ç›®, 1: å·¦ç›®, 2: é¼», 3: å£, 4: å³è€³, 5: å·¦è€³
            
            // ç›®ã®æ¤œå‡ºçŠ¶æ…‹ (ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹0ã¨1)
            const hasRightEye = face.landmarks && face.landmarks[0];
            const hasLeftEye = face.landmarks && face.landmarks[1];
            
            if (hasLeftEye && hasRightEye) {
                eyesStatusElement.textContent = 'æ¤œå‡º (ä¸¡ç›®)';
                eyesStatusElement.className = 'detected';
            } else if (hasLeftEye || hasRightEye) {
                eyesStatusElement.textContent = 'æ¤œå‡º (ç‰‡ç›®)';
                eyesStatusElement.className = 'detected';
            } else {
                eyesStatusElement.textContent = 'æœªæ¤œå‡º';
                eyesStatusElement.className = 'not-detected';
            }
            
            // é¼»ã®æ¤œå‡ºçŠ¶æ…‹ (ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹2)
            const hasNose = face.landmarks && face.landmarks[2];
            noseStatusElement.textContent = hasNose ? 'æ¤œå‡º' : 'æœªæ¤œå‡º';
            noseStatusElement.className = hasNose ? 'detected' : 'not-detected';
            
            // å£ã®æ¤œå‡ºçŠ¶æ…‹ (ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹3)
            const hasMouth = face.landmarks && face.landmarks[3];
            mouthStatusElement.textContent = hasMouth ? 'æ¤œå‡º' : 'æœªæ¤œå‡º';
            mouthStatusElement.className = hasMouth ? 'detected' : 'not-detected';
            
            // è€³ã®æ¤œå‡ºçŠ¶æ…‹ (ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹4ã¨5)
            const hasRightEar = face.landmarks && face.landmarks[4];
            const hasLeftEar = face.landmarks && face.landmarks[5];
            earsStatusElement.textContent = (hasRightEar || hasLeftEar) ? 'æ¤œå‡º' : 'æœªæ¤œå‡º';
            earsStatusElement.className = (hasRightEar || hasLeftEar) ? 'detected' : 'not-detected';
        }
        
        // å¢ƒç•Œãƒœãƒƒã‚¯ã‚¹ã®æç”»
        function drawBoundingBox(boundingBox) {
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 2;
            ctx.strokeRect(
                boundingBox.topLeft[0],
                boundingBox.topLeft[1],
                boundingBox.bottomRight[0] - boundingBox.topLeft[0],
                boundingBox.bottomRight[1] - boundingBox.topLeft[1]
            );
        }
        
        // ç‰¹å¾´ç‚¹ã®æç”»
        function drawFacialLandmarks(mesh) {
            ctx.fillStyle = '#FF5722';
            
            for (let i = 0; i < mesh.length; i++) {
                const [x, y] = mesh[i];
                ctx.beginPath();
                ctx.arc(x, y, 1, 0, 2 * Math.PI);
                ctx.fill();
            }
        }
        
        // é¡”ã®ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆè¼ªéƒ­ç·šï¼‰ã®æç”»
        function drawFacialWireframe(face) {
            ctx.strokeStyle = '#2196F3';
            ctx.lineWidth = 1;
            
            // é¡”ã®è¼ªéƒ­
            drawConnectors(ctx, face.annotations.silhouette);
            
            // å·¦çœ‰
            drawConnectors(ctx, face.annotations.leftEyebrowUpper);
            drawConnectors(ctx, face.annotations.leftEyebrowLower);
            
            // å³çœ‰
            drawConnectors(ctx, face.annotations.rightEyebrowUpper);
            drawConnectors(ctx, face.annotations.rightEyebrowLower);
            
            // é¼»
            drawConnectors(ctx, face.annotations.noseBridge);
            drawConnectors(ctx, face.annotations.noseBottom);
            
            // å·¦ç›®
            drawConnectors(ctx, face.annotations.leftEyeUpper, true);
            drawConnectors(ctx, face.annotations.leftEyeLower, true);
            
            // å³ç›®
            drawConnectors(ctx, face.annotations.rightEyeUpper, true);
            drawConnectors(ctx, face.annotations.rightEyeLower, true);
            
            // å·¦ç›®ã®è™¹å½©
            if (face.annotations.leftEyeIris) {
                drawIris(ctx, face.annotations.leftEyeIris);
            }
            
            // å³ç›®ã®è™¹å½©
            if (face.annotations.rightEyeIris) {
                drawIris(ctx, face.annotations.rightEyeIris);
            }
            
            // å”‡ã®å¤–å´
            drawConnectors(ctx, face.annotations.lipsUpperOuter, true);
            drawConnectors(ctx, face.annotations.lipsLowerOuter, true);
            
            // å”‡ã®å†…å´
            drawConnectors(ctx, face.annotations.lipsUpperInner, true);
            drawConnectors(ctx, face.annotations.lipsLowerInner, true);
        }
        
        // è¼ªéƒ­ç·šã®æç”»ãƒ˜ãƒ«ãƒ‘ãƒ¼
        function drawConnectors(ctx, points, closePath = false) {
            if (!points || points.length === 0) return;
            
            ctx.beginPath();
            ctx.moveTo(points[0][0], points[0][1]);
            
            for (let i = 1; i < points.length; i++) {
                const point = points[i];
                ctx.lineTo(point[0], point[1]);
            }
            
            if (closePath) {
                ctx.closePath();
            }
