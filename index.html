<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„É™„Ç¢„É´„Çø„Ç§„É†È°îÁâπÂæ¥ÁÇπÊ§úÂá∫ - È´òÂ∫¶Áâà</title>
    <!-- „Éû„ÉÜ„É™„Ç¢„É´„Éá„Ç∂„Ç§„É≥„ÅÆ„Ç¢„Ç§„Ç≥„É≥„Å®„Éï„Ç©„É≥„Éà -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/material-design-icons/3.0.1/iconfont/material-icons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/Roboto/0.2.0/roboto-fontface.css" rel="stylesheet">
    <!-- TensorFlow.js „Ç≥„Ç¢„É©„Ç§„Éñ„É©„É™ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/3.18.0/tf.min.js"></script>
    <!-- Face Landmarks Detection „É©„Ç§„Éñ„É©„É™ -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@0.0.3/dist/face-landmarks-detection.min.js"></script>
    <style>
        :root {
            --primary-color: #3f51b5;
            --primary-light: #757de8;
            --primary-dark: #002984;
            --accent-color: #ff4081;
            --text-on-primary: #ffffff;
            --text-primary: rgba(0, 0, 0, 0.87);
            --text-secondary: rgba(0, 0, 0, 0.54);
            --background-color: #f5f5f5;
            --card-color: #ffffff;
            --divider-color: rgba(0, 0, 0, 0.12);
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', 'Noto Sans JP', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.5;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .app-bar {
            background-color: var(--primary-color);
            color: var(--text-on-primary);
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .app-title {
            font-size: 1.25rem;
            font-weight: 500;
            margin-left: 8px;
        }
        
        .main-content {
            flex: 1;
            padding: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .card {
            background-color: var(--card-color);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
            overflow: hidden;
            margin-bottom: 24px;
            width: 100%;
        }
        
        .card-title {
            padding: 16px;
            font-size: 1.25rem;
            font-weight: 500;
            border-bottom: 1px solid var(--divider-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-content {
            padding: 16px;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            margin: 0 auto;
            border-radius: 4px;
            overflow: hidden;
        }
        
        video, canvas {
            width: 100%;
            max-width: 640px;
            max-height: 480px;
            display: block;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 16px;
            justify-content: center;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0 16px;
            height: 36px;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.0892857143em;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
        }
        
        .btn-icon {
            margin-right: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: var(--text-on-primary);
        }
        
        .btn-primary:hover {
            background-color: var(--primary-light);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary:disabled {
            background-color: rgba(0, 0, 0, 0.12);
            color: rgba(0, 0, 0, 0.38);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .btn-accent {
            background-color: var(--accent-color);
            color: var(--text-on-primary);
        }
        
        .btn-accent:hover {
            background-color: #ff5a92;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .btn-accent:disabled {
            background-color: rgba(0, 0, 0, 0.12);
            color: rgba(0, 0, 0, 0.38);
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .info-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-top: 16px;
        }
        
        .info-card {
            flex: 1;
            min-width: 200px;
            background-color: var(--card-color);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 16px;
        }
        
        .info-card-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .status-bar {
            display: flex;
            align-items: center;
            margin-top: 16px;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .status-message {
            flex: 1;
        }
        
        .fps-counter {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .part-detection-list {
            list-style: none;
            margin-top: 8px;
        }
        
        .part-detection-item {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }
        
        .part-icon {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .part-status {
            flex: 1;
        }
        
        .detected {
            color: var(--success-color);
        }
        
        .not-detected {
            color: var(--error-color);
        }
        
        .options-container {
            margin-top: 16px;
        }
        
        .option-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .option-label {
            flex: 1;
            font-size: 0.875rem;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 36px;
            height: 20px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.38);
            transition: .4s;
            border-radius: 10px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(16px);
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }
            
            .info-card {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-bar">
            <i class="material-icons">face</i>
            <h1 class="app-title">„É™„Ç¢„É´„Çø„Ç§„É†È°îÁâπÂæ¥ÁÇπÊ§úÂá∫ - È´òÂ∫¶Áâà</h1>
        </header>
        
        <main class="main-content">
            <div class="card">
                <div class="card-title">
                    <span>„Ç´„É°„É©„Éì„É•„Éº</span>
                    <div id="fps" class="fps-counter">0 FPS</div>
                </div>
                <div class="card-content">
                    <div class="video-container">
                        <video id="video" autoplay muted playsinline></video>
                        <canvas id="canvas"></canvas>
                        <div id="fps-display" class="fps-counter">0 FPS</div>
                    </div>
                    
                    <div class="controls">
                        <button id="startButton" class="btn btn-primary" disabled>
                            <i class="material-icons btn-icon">videocam</i>
                            „Ç´„É°„É©ÈñãÂßã
                        </button>
                        <button id="stopButton" class="btn btn-accent" disabled>
                            <i class="material-icons btn-icon">stop</i>
                            ÂÅúÊ≠¢
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="info-panel">
                <div class="info-card">
                    <h3 class="info-card-title">È°î„Éë„Éº„ÉÑÊ§úÂá∫Áä∂Ê≥Å</h3>
                    <ul class="part-detection-list" id="parts-list">
                        <li class="part-detection-item">
                            <div class="part-icon"><i class="material-icons">face</i></div>
                            <div class="part-status">È°î: <span id="face-status" class="not-detected">Êú™Ê§úÂá∫</span></div>
                        </li>
                        <li class="part-detection-item">
                            <div class="part-icon"><i class="material-icons">remove_red_eye</i></div>
                            <div class="part-status">ÁõÆ: <span id="eyes-status" class="not-detected">Êú™Ê§úÂá∫</span></div>
                        </li>
                        <li class="part-detection-item">
                            <div class="part-icon">üëÉ</div>
                            <div class="part-status">Èºª: <span id="nose-status" class="not-detected">Êú™Ê§úÂá∫</span></div>
                        </li>
                        <li class="part-detection-item">
                            <div class="part-icon">üëÑ</div>
                            <div class="part-status">Âè£: <span id="mouth-status" class="not-detected">Êú™Ê§úÂá∫</span></div>
                        </li>
                        <li class="part-detection-item">
                            <div class="part-icon">üëÇ</div>
                            <div class="part-status">ËÄ≥: <span id="ears-status" class="not-detected">Êú™Ê§úÂá∫</span></div>
                        </li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3 class="info-card-title">Ê§úÂá∫ÊÉÖÂ†±</h3>
                    <div id="detection-info">
                        <p>ÁâπÂæ¥ÁÇπ: <span id="landmark-count">0</span> ÁÇπ</p>
                        <p>Ê§úÂá∫Á≤æÂ∫¶: <span id="detection-score">0</span>%</p>
                        <p>Âá¶ÁêÜÊôÇÈñì: <span id="processing-time">0</span> ms</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">Ë°®Á§∫„Ç™„Éó„Ç∑„Éß„É≥</div>
                <div class="card-content">
                    <div class="options-container">
                        <div class="option-row">
                            <span class="option-label">È°î„ÅÆÂ¢ÉÁïå„Éú„ÉÉ„ÇØ„Çπ„ÇíË°®Á§∫</span>
                            <label class="switch">
                                <input type="checkbox" id="show-box" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="option-row">
                            <span class="option-label">ÁâπÂæ¥ÁÇπ„ÇíË°®Á§∫</span>
                            <label class="switch">
                                <input type="checkbox" id="show-landmarks" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="option-row">
                            <span class="option-label">Ëº™ÈÉ≠Á∑ö„ÇíË°®Á§∫</span>
                            <label class="switch">
                                <input type="checkbox" id="show-wireframe" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="status-bar">
                <div id="status" class="status-message">„É¢„Éá„É´„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
            </div>
        </main>
    </div>
    
    <script>
        // DOMË¶ÅÁ¥†
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const statusElement = document.getElementById('status');
        const fpsDisplay = document.getElementById('fps-display');
        const landmarkCountElement = document.getElementById('landmark-count');
        const detectionScoreElement = document.getElementById('detection-score');
        const processingTimeElement = document.getElementById('processing-time');
        
        // „Éë„Éº„ÉÑÊ§úÂá∫„Çπ„ÉÜ„Éº„Çø„ÇπË¶ÅÁ¥†
        const faceStatusElement = document.getElementById('face-status');
        const eyesStatusElement = document.getElementById('eyes-status');
        const noseStatusElement = document.getElementById('nose-status');
        const mouthStatusElement = document.getElementById('mouth-status');
        const earsStatusElement = document.getElementById('ears-status');
        
        // Ë°®Á§∫„Ç™„Éó„Ç∑„Éß„É≥
        const showBoxCheckbox = document.getElementById('show-box');
        const showLandmarksCheckbox = document.getElementById('show-landmarks');
        const showWireframeCheckbox = document.getElementById('show-wireframe');
        
        // Â§âÊï∞
        let isRunning = false;
        let stream = null;
        let model = null;
        let animationId = null;
        let lastFrameTime = 0;
        let frameCount = 0;
        let lastFpsUpdateTime = 0;
        let currentFps = 0;
        
        // FPSË®àÁÆóÁî®„ÅÆÂ§âÊï∞
        function updateFps() {
            const now = performance.now();
            frameCount++;
            
            // 500„Éü„É™Áßí„Åî„Å®„Å´FPS„ÇíÊõ¥Êñ∞
            if (now - lastFpsUpdateTime >= 500) {
                currentFps = Math.round((frameCount * 1000) / (now - lastFpsUpdateTime));
                fpsDisplay.textContent = `${currentFps} FPS`;
                lastFpsUpdateTime = now;
                frameCount = 0;
            }
        }
        
        // „É¢„Éá„É´„ÅÆË™≠„ÅøËæº„Åø
        async function loadModel() {
            try {
                statusElement.textContent = 'È°îÊ§úÂá∫„É¢„Éá„É´„ÇíË™≠„ÅøËæº„Åø‰∏≠...';
                
                // Face Landmarks Detection „É¢„Éá„É´„ÇíË™≠„ÅøËæº„ÇÄ
                model = await faceLandmarksDetection.load(
                    faceLandmarksDetection.SupportedPackages.mediapipeFacemesh,
                    {
                        maxFaces: 1, // Ê§úÂá∫„Åô„ÇãÈ°î„ÅÆÊúÄÂ§ßÊï∞
                        refineLandmarks: true, // ËôπÂΩ©„ÇíÂê´„ÇÄË©≥Á¥∞„Å™„É©„É≥„Éâ„Éû„Éº„ÇØ
                        staticImageMode: false // „Éì„Éá„Ç™„Çπ„Éà„É™„Éº„É†Áî®
                    }
                );
                
                statusElement.textContent = '„É¢„Éá„É´„ÅÆË™≠„ÅøËæº„Åø„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ„Ç´„É°„É©„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                startButton.disabled = false;
            } catch (error) {
                statusElement.textContent = `„Ç®„É©„Éº: „É¢„Éá„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü - ${error.message}`;
                console.error('„É¢„Éá„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:', error);
            }
        }
        
        // „Ç´„É°„É©„ÅÆÈñãÂßã
        async function startCamera() {
            if (isRunning) return;
            
            try {
                // „Ç´„É°„É©„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ
                stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }
                });
                
                video.srcObject = stream;
                
                // „Éì„Éá„Ç™„ÅÆÊ∫ñÂÇô„Åå„Åß„Åç„Çã„ÅÆ„ÇíÂæÖ„Å§
                await new Promise(resolve => {
                    video.onloadedmetadata = () => {
                        resolve();
                    };
                });
                
                // „Éì„Éá„Ç™ÂÜçÁîüÈñãÂßã
                await video.play();
                
                // „Ç≠„É£„É≥„Éê„Çπ„ÅÆ„Çµ„Ç§„Ç∫„Çí„Éì„Éá„Ç™„Å´Âêà„Çè„Åõ„Çã
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // Ê§úÂá∫ÈñãÂßã
                isRunning = true;
                lastFrameTime = performance.now();
                lastFpsUpdateTime = performance.now();
                frameCount = 0;
                detectFaces();
                
                // „Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
                startButton.disabled = true;
                stopButton.disabled = false;
                statusElement.textContent = 'È°îÁâπÂæ¥ÁÇπÊ§úÂá∫ÂÆüË°å‰∏≠...';
            } catch (error) {
                statusElement.textContent = `„Ç®„É©„Éº: „Ç´„É°„É©„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü - ${error.message}`;
                console.error('„Ç´„É°„É©„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„Å´Â§±Êïó:', error);
            }
        }
        
        // „Ç´„É°„É©„ÅÆÂÅúÊ≠¢
        function stopCamera() {
            if (!isRunning) return;
            
            // „Çπ„Éà„É™„Éº„É†„ÅÆÂÅúÊ≠¢
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
                stream = null;
            }
            
            // Ê§úÂá∫Âá¶ÁêÜ„ÅÆÂÅúÊ≠¢
            isRunning = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            // „Ç≠„É£„É≥„Éê„Çπ„ÅÆ„ÇØ„É™„Ç¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // „Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆ„É™„Çª„ÉÉ„Éà
            resetDetectionStatus();
            
            // „Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            startButton.disabled = false;
            stopButton.disabled = true;
            statusElement.textContent = 'ÂÅúÊ≠¢„Åó„Åæ„Åó„Åü';
        }
        
        // Ê§úÂá∫„Çπ„ÉÜ„Éº„Çø„Çπ„ÅÆ„É™„Çª„ÉÉ„Éà
        function resetDetectionStatus() {
            faceStatusElement.textContent = 'Êú™Ê§úÂá∫';
            faceStatusElement.className = 'not-detected';
            eyesStatusElement.textContent = 'Êú™Ê§úÂá∫';
            eyesStatusElement.className = 'not-detected';
            noseStatusElement.textContent = 'Êú™Ê§úÂá∫';
            noseStatusElement.className = 'not-detected';
            mouthStatusElement.textContent = 'Êú™Ê§úÂá∫';
            mouthStatusElement.className = 'not-detected';
            earsStatusElement.textContent = 'Êú™Ê§úÂá∫';
            earsStatusElement.className = 'not-detected';
            
            landmarkCountElement.textContent = '0';
            detectionScoreElement.textContent = '0';
            processingTimeElement.textContent = '0';
            fpsDisplay.textContent = '0 FPS';
        }
        
        // È°î„ÅÆÊ§úÂá∫„Å®ÁâπÂæ¥ÁÇπ„ÅÆÊèèÁîª
        async function detectFaces() {
            if (!isRunning) return;
            
            const startTime = performance.now();
            
            try {
                // FPSË°®Á§∫„ÅÆÊõ¥Êñ∞
                updateFps();
                
                // È°î„ÅÆ„É©„É≥„Éâ„Éû„Éº„ÇØÊ§úÂá∫„ÇíÂÆüË°å
                const predictions = await model.estimateFaces({
                    input: video,
                    returnTensors: false,
                    flipHorizontal: false,
                    predictIrises: true
                });
                
                // „Ç≠„É£„É≥„Éê„Çπ„ÅÆ„ÇØ„É™„Ç¢
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Ê§úÂá∫„Åï„Çå„ÅüÈ°î„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØÊèèÁîª
                if (predictions && predictions.length > 0) {
                    const face = predictions[0]; // ÁèæÂú®„ÅØ1„Å§„ÅÆÈ°î„ÅÆ„Åø„Çí„Çµ„Éù„Éº„Éà
                    
                    // È°îÊ§úÂá∫„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
                    updateFaceDetectionStatus(face);
                    
                    // ÊÉÖÂ†±„ÅÆÊõ¥Êñ∞
                    const landmarkCount = face.mesh ? face.mesh.length : 0;
                    landmarkCountElement.textContent = landmarkCount.toString();
                    
                    // Ê§úÂá∫Á≤æÂ∫¶ÔºàÂÖ®„Å¶„ÅÆÁÇπ„ÅÆÂπ≥ÂùáÔºâ
                    const score = Math.round(face.faceInViewConfidence * 100);
                    detectionScoreElement.textContent = score.toString();
                    
                    // Â¢ÉÁïå„Éú„ÉÉ„ÇØ„Çπ„ÅÆÊèèÁîªÔºàÊúâÂäπ„Å™Â†¥ÂêàÔºâ
                    if (showBoxCheckbox.checked && face.boundingBox) {
                        drawBoundingBox(face.boundingBox);
                    }
                    
                    // ÁâπÂæ¥ÁÇπ„ÅÆÊèèÁîªÔºàÊúâÂäπ„Å™Â†¥ÂêàÔºâ
                    if (showLandmarksCheckbox.checked && face.mesh) {
                        drawFacialLandmarks(face.mesh);
                    }
                    
                    // „ÉØ„Ç§„É§„Éº„Éï„É¨„Éº„É†„ÅÆÊèèÁîªÔºàÊúâÂäπ„Å™Â†¥ÂêàÔºâ
                    if (showWireframeCheckbox.checked && face.mesh) {
                        drawFacialWireframe(face);
                    }
                } else {
                    // È°î„ÅåÊ§úÂá∫„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„É™„Çª„ÉÉ„Éà
                    resetDetectionStatus();
                }
                
                // Âá¶ÁêÜÊôÇÈñì„ÅÆÊõ¥Êñ∞
                const processingTime = Math.round(performance.now() - startTime);
                processingTimeElement.textContent = processingTime.toString();
                
            } catch (error) {
                console.error('È°îÊ§úÂá∫„Ç®„É©„Éº:', error);
                statusElement.textContent = `Ê§úÂá∫„Ç®„É©„Éº: ${error.message}`;
            }
            
            // Ê¨°„ÅÆ„Éï„É¨„Éº„É†„ÇíÂá¶ÁêÜ
            animationId = requestAnimationFrame(detectFaces);
        }
        
        // È°îÊ§úÂá∫„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
        function updateFaceDetectionStatus(face) {
            // È°î„ÅÆÊ§úÂá∫Áä∂ÊÖã„ÇíÊõ¥Êñ∞
            faceStatusElement.textContent = 'Ê§úÂá∫';
            faceStatusElement.className = 'detected';
            
            // ÁõÆ„ÅÆÊ§úÂá∫Áä∂ÊÖã
            const hasLeftEye = face.annotations && face.annotations.leftEyeIris;
            const hasRightEye = face.annotations && face.annotations.rightEyeIris;
            
            if (hasLeftEye && hasRightEye) {
                eyesStatusElement.textContent = 'Ê§úÂá∫ (‰∏°ÁõÆ)';
                eyesStatusElement.className = 'detected';
            } else if (hasLeftEye || hasRightEye) {
                eyesStatusElement.textContent = 'Ê§úÂá∫ (ÁâáÁõÆ)';
                eyesStatusElement.className = 'detected';
            } else {
                eyesStatusElement.textContent = 'Êú™Ê§úÂá∫';
                eyesStatusElement.className = 'not-detected';
            }
            
            // Èºª„ÅÆÊ§úÂá∫Áä∂ÊÖã
            const hasNose = face.annotations && face.annotations.nose && face.annotations.nose.length > 0;
            noseStatusElement.textContent = hasNose ? 'Ê§úÂá∫' : 'Êú™Ê§úÂá∫';
            noseStatusElement.className = hasNose ? 'detected' : 'not-detected';
            
            // Âè£„ÅÆÊ§úÂá∫Áä∂ÊÖã
            const hasMouth = face.annotations && 
                           ((face.annotations.lipsUpperOuter && face.annotations.lipsUpperOuter.length > 0) || 
                            (face.annotations.lipsLowerOuter && face.annotations.lipsLowerOuter.length > 0));
            mouthStatusElement.textContent = hasMouth ? 'Ê§úÂá∫' : 'Êú™Ê§úÂá∫';
            mouthStatusElement.className = hasMouth ? 'detected' : 'not-detected';
            
            // ËÄ≥„ÅÆÊ§úÂá∫Áä∂ÊÖã
            const hasEars = face.annotations && 
                          ((face.annotations.leftEarTragion && face.annotations.leftEarTragion.length > 0) || 
                           (face.annotations.rightEarTragion && face.annotations.rightEarTragion.length > 0));
            earsStatusElement.textContent = hasEars ? 'Ê§úÂá∫' : 'Êú™Ê§úÂá∫';
            earsStatusElement.className = hasEars ? 'detected' : 'not-detected';
        }
        
        // Â¢ÉÁïå„Éú„ÉÉ„ÇØ„Çπ„ÅÆÊèèÁîª
        function drawBoundingBox(boundingBox) {
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 2;
            ctx.strokeRect(
                boundingBox.topLeft[0],
                boundingBox.topLeft[1],
                boundingBox.bottomRight[0] - boundingBox.topLeft[0],
                boundingBox.bottomRight[1] - boundingBox.topLeft[1]
            );
        }
        
        // ÁâπÂæ¥ÁÇπ„ÅÆÊèèÁîª
        function drawFacialLandmarks(mesh) {
            ctx.fillStyle = '#FF5722';
            
            for (let i = 0; i < mesh.length; i++) {
                const [x, y] = mesh[i];
                ctx.beginPath();
                ctx.arc(x, y, 1, 0, 2 * Math.PI);
                ctx.fill();
            }
        }
        
        // È°î„ÅÆ„ÉØ„Ç§„É§„Éº„Éï„É¨„Éº„É†ÔºàËº™ÈÉ≠Á∑öÔºâ„ÅÆÊèèÁîª
        function drawFacialWireframe(face) {
            ctx.strokeStyle = '#2196F3';
            ctx.lineWidth = 1;
            
            // È°î„ÅÆËº™ÈÉ≠
            drawConnectors(ctx, face.annotations.silhouette);
            
            // Â∑¶Áúâ
            drawConnectors(ctx, face.annotations.leftEyebrowUpper);
            drawConnectors(ctx, face.annotations.leftEyebrowLower);
            
            // Âè≥Áúâ
            drawConnectors(ctx, face.annotations.rightEyebrowUpper);
            drawConnectors(ctx, face.annotations.rightEyebrowLower);
            
            // Èºª
            drawConnectors(ctx, face.annotations.noseBridge);
            drawConnectors(ctx, face.annotations.noseBottom);
            
            // Â∑¶ÁõÆ
            drawConnectors(ctx, face.annotations.leftEyeUpper, true);
            drawConnectors(ctx, face.annotations.leftEyeLower, true);
            
            // Âè≥ÁõÆ
            drawConnectors(ctx, face.annotations.rightEyeUpper, true);
            drawConnectors(ctx, face.annotations.rightEyeLower, true);
            
            // Â∑¶ÁõÆ„ÅÆËôπÂΩ©
            if (face.annotations.leftEyeIris) {
                drawIris(ctx, face.annotations.leftEyeIris);
            }
            
            // Âè≥ÁõÆ„ÅÆËôπÂΩ©
            if (face.annotations.rightEyeIris) {
                drawIris(ctx, face.annotations.rightEyeIris);
            }
            
            // Âîá„ÅÆÂ§ñÂÅ¥
            drawConnectors(ctx, face.annotations.lipsUpperOuter, true);
            drawConnectors(ctx, face.annotations.lipsLowerOuter, true);
            
            // Âîá„ÅÆÂÜÖÂÅ¥
            drawConnectors(ctx, face.annotations.lipsUpperInner, true);
            drawConnectors(ctx, face.annotations.lipsLowerInner, true);
        }
        
        // Ëº™ÈÉ≠Á∑ö„ÅÆÊèèÁîª„Éò„É´„Éë„Éº
        function drawConnectors(ctx, points, closePath = false) {
            if (!points || points.length === 0) return;
            
            ctx.beginPath();
            ctx.moveTo(points[0][0], points[0][1]);
            
            for (let i = 1; i < points.length; i++) {
                const point = points[i];
                ctx.lineTo(point[0], point[1]);
            }
            
            if (closePath) {
                ctx.closePath();
            }
